---
layout:     post
title:      Rustä¹‹å…³è”å‡½æ•°ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ä¸æ¥å£
subtitle:   newæ„é€ å‡½æ•°ã€methodæ–¹æ³•çš„åŒºåˆ«
date:       2024-12-09
author:     æ±¤æ±¤
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - Rust
    - new
    - method
    - trait
    - é™æ€æ–¹æ³•
    - å…³è”å‡½æ•°
    - Note
    - cpp
---
> æ¥è‡ª [black-hat-rust](https://github.com/skerkour/black-hat-rust) 

|   |--  |åç§°|å¯¼èˆª|
|:-:|:-----:|:--------------:|:---:|
|ğŸ—¹ |æšä¸¾    |Option|Rustä¹‹optionã€resultæšä¸¾ç±»å‹|
|ğŸ—¹ |æšä¸¾    |Result|Rustä¹‹optionã€resultæšä¸¾ç±»å‹|
|ğŸ—¹ |æšä¸¾å˜ä½“|Some  |Rustä¹‹optionã€resultæšä¸¾ç±»å‹|
|ğŸ—¹ |æšä¸¾å˜ä½“|Ok    |Rustä¹‹optionã€resultæšä¸¾ç±»å‹|
|ğŸ—¹ |æšä¸¾å˜ä½“|Err   |Rustä¹‹optionã€resultæšä¸¾ç±»å‹|
|ğŸ—¹ |å…³é”®å­—  |match |Rustä¹‹matchã€letã€lf-letå…³é”®å­—|
|ğŸ—¹ |å…³é”®å­—  |let   |Rustä¹‹matchã€letã€lf-letå…³é”®å­—|
|ğŸ—¹ |å…³é”®å­—  |if let|Rustä¹‹matchã€letã€lf-letå…³é”®å­—|
|ğŸ—¹ |æ¥å£    |Error |Rustä¹‹Erroræ¥å£ï¼ˆtraitï¼‰|
|ğŸ—¹ |æ¥å£    |From  |Rustä¹‹Fromæ¥å£ï¼ˆtraitï¼‰ |
|ğŸ—¹ |æ¥å£    |Into  |Rustä¹‹Fromã€Intoæ¥å£ï¼ˆtraitï¼‰|
|ğŸ—¹ |æ¥å£çš„å®šä¹‰|trait|Rustä¹‹Erroræ¥å£ï¼ˆtraitï¼‰|
|â˜ |ç»“æ„ä½“  |fmt::Formatter|Rustä¹‹Erroræ¥å£ï¼ˆtraitï¼‰|
|ğŸ—¹ |æ³›å‹å‡½æ•° |<T>  |Rustä¹‹æ³›å‹å‡½æ•°|
|â˜ |å…³è”å‡½æ•°|new()  |Rustä¹‹å…³è”å‡½æ•°ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ä¸æ¥å£|
|â˜ |å…³è”å‡½æ•°|default|Rustä¹‹å…³è”å‡½æ•°ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ä¸æ¥å£|
|â˜ |å…³è”å‡½æ•°|from   |Rustä¹‹å…³è”å‡½æ•°ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ä¸æ¥å£|


### Question:æ¥å£å’Œæ–¹æ³•åŒºåˆ«å…·ä½“åœ¨å“ªé‡Œï¼Ÿä»€ä¹ˆæ˜¯å…³è”å‡½æ•°ï¼Ÿ
> å¸¦ç€è¿™ä¸ªé—®é¢˜ä¸€èµ·æ¥çœ‹  

### å…³è”å‡½æ•°
> å®šä¹‰åœ¨æŸä¸ªç±»å‹ï¼ˆç»“æ„ä½“ã€æšä¸¾ç­‰ï¼‰ä¸Šçš„å‡½æ•°ï¼Œä¸éœ€è¦é€šè¿‡å®ä¾‹å»è°ƒç”¨

+ ä½¿ç”¨æ–¹æ³•ï¼š`TypeName::function_name()`
+ å¸¸è§ä¾‹å­
  + æ„é€ å‡½æ•°new()
  + ä¸ç±»å‹ç›¸å…³çš„å®ç”¨å·¥å…·å‡½æ•°
  + 
+ ä¸`æ–¹æ³•method`çš„åŒºåˆ«
  + æ–¹æ³•éœ€è¦é€šè¿‡å®ä¾‹è°ƒç”¨ï¼ˆé€šå¸¸ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`self`ï¼Œè¡¨ç¤ºæ–¹æ³•æ˜¯ä½œç”¨åœ¨æŸä¸ªå…·ä½“å®ä¾‹ä¸Šçš„ï¼‰
  + å…³è”å‡½æ•°ä¸éœ€è¦`self`å‚æ•°ï¼Œä¸ä¸å…·ä½“å®ä¾‹ç»‘å®š
  + â­â­â­ç‰¹åˆ«çš„ï¼Œæ„é€ å‡½æ•°ä¸€èˆ¬ç”¨æ¥åˆ›å»ºå®ä¾‹ï¼›å®ä¾‹ä»è€Œå¯ä»¥è°ƒç”¨æ–¹æ³•ã€‚

#### new()æ„é€ å‡½æ•°
###### 1. ç¤ºä¾‹
```rust
struct Rectangle {
    width: u32,
    height: u32,
}

impl Rectangle {
    // ä¸€ä¸ªå…³è”å‡½æ•°ï¼Œç”¨æ¥æ„é€ æ–°çš„ Rectangle
    fn new(width: u32, height: u32) -> Self {
        Self { width, height }
    }
    
    // ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œç”¨æ¥è®¡ç®—é¢ç§¯
    fn area(&self) -> u32 {
        self.width * self.height
    }
}

fn main() {
    // è°ƒç”¨å…³è”å‡½æ•°æ¥åˆ›å»ºå®ä¾‹
    let rect = Rectangle::new(30, 50);
    
    // è°ƒç”¨å®ä¾‹æ–¹æ³•
    println!("Area of rectangle: {}", rect.area());
}
```

###### 2. ä¸ºä»€ä¹ˆä½¿ç”¨æ„é€ å‡½æ•°
> ä¸€ä¸ªç›´æˆªäº†å½“çš„å›ç­”æ˜¯ï¼Œä½¿ç”¨æ„é€ å‡½æ•°ä¸ºæŸä¸ªç±»å‹åˆ›å»ºå®ä¾‹ï¼Œå®ç°å®ä¾‹çš„åˆå§‹åŒ–ã€‚  
> ä½†ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåªèƒ½ä½¿ç”¨new()æ„é€ å‡½æ•°å®ç°ç»“æ„ä½“ç­‰ç±»å‹çš„åˆå§‹åŒ–å—ï¼Ÿ  
> å½“ç„¶ä¸æ˜¯ã€‚  

1. ç›´æ¥åˆå§‹åŒ–å„ä¸ªå­—æ®µåˆ›å»ºç»“æ„ä½“å®ä¾‹ã€‚å‡è®¾æœ‰ä¸€ä¸ª`Point`ç»“æ„ä½“ï¼š`let p = Point{x: 10, y: 20};`
2. ä½¿ç”¨æ„é€ å‡½æ•°
   1. :bulb:ç»“æ„ä½“æä¾›é»˜è®¤å€¼ï¼ˆæˆ–ç»“æ„ä½“åˆå§‹åŒ–é€»è¾‘å¤æ‚ï¼‰çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨new()å°±å¯ä»¥ä¸ç”¨æ‰‹åŠ¨è®¾ç½®æ¯ä¸ªå­—æ®µ
   2. æ›´è¿›ä¸€æ­¥:bulb::bulb:ï¼Œå¯ä»¥å°è£…åˆå§‹åŒ–é€»è¾‘ï¼Œé˜²æ­¢åˆå§‹åŒ–æ—¶ä¼ å…¥éæ³•å€¼

   ```rust
   fn new(width: u32, height: u32) -> Self {
        assert!(width > 0 && height > 0, "Width and height must be positive");
        Self { width, height }
    }
   ```
###### 3. æ„é€ å‡½æ•°åªèƒ½æ˜¯new()å—:å·¥å‚æ–¹æ³•
> :star2: newæ˜¯æ„é€ å‡½æ•°æŒ‡å®šå…³é”®å­—å—ï¼Ÿ  
> å…¶å®ä¸æ˜¯ï¼Œnewåªæ˜¯ä¸€ä¸ªæƒ¯ä¾‹ï¼Œrustç¤¾åŒºéµå¾ªäº†è¿™ä¸ªçº¦å®šè€Œå·²  
> é™¤æ­¤ä¹‹å¤–ï¼Œå¼€å‘è€…é—®äº†æé«˜è¯­ä¹‰ä¸å¯è¯»æ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰æ„é€ å‡½æ•°åå­—ã€‚æ¯”è¾ƒå¸¸è§çš„æœ‰
`from` `default`ç­‰

1. å¤šä¸ªæ„é€ å‡½æ•°ç¤ºä¾‹ 

```rust
struct Shape {
    width: u32,
    height: u32,
}

impl Shape {
    fn square(size: u32) -> Self {
        Self { width: size, height: size }
    }

    fn rectangle(width: u32, height: u32) -> Self {
        Self { width, height }
    }
}

fn main() {
    let square = Shape::square(10);
    let rectangle = Shape::rectangle(10, 20);
}
```

#### from æ„é€ å‡½æ•°
> å°†ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„æ„é€ å‡½æ•°  
#### default æ„é€ å‡½æ•°
> é€šè¿‡defaultç‰¹è´¨å®ç°é»˜è®¤æ„é€ å‡½æ•°

#### å…¶ä»–å…³è”å‡½æ•°
###### trait
```rust
trait Shape { // ä¸€ä¸ªshapeæ¥å£ï¼Œ
    fn description() -> String; //å®šä¹‰äº†ä¸€ä¸ªå…³è”å‡½æ•°descriptionï¼Œä¸ä¾èµ–å®ä¾‹ï¼Œä¹Ÿæ²¡æœ‰selfå‚æ•°
}

struct Circle; // å®šä¹‰ä¸€ä¸ªcircleç»“æ„ä½“

impl Shape for Circle { //ä¸ºcircleç»“æ„ä½“å®ç°shapeæ¥å£
    fn description() -> String {
        String::from("I am a circle.")//æ˜¯åº“å‡½æ•°é‡Œçš„ä¸€ä¸ªå…³è”å‡½æ•°ï¼Œå°†åˆ‡ç‰‡ç±»å‹&strè½¬æ¢ä¸ºå †åˆ†é…String
    }
}

fn main() {
    println!("{}", Circle::description());// ç›´æ¥ä½¿ç”¨::è¯­æ³•è°ƒç”¨å…³è”å‡½æ•°ï¼Œä¸éœ€è¦åˆ›å»ºå®ä¾‹
}
```
