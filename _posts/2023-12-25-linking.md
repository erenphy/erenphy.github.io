---
layout:     post
title:      ELF标准格式
subtitle:   动态链接与静态链接
date:       2023-12-13
author:     汤汤
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 编译
    - cpp
---
> 来自《深入理解计算机系统》
## 静态链接
#### ELF-64可重定位目标文件

```markdown
-----------------------  
|     ELF header      |  
-----------------------  
|      .text          |  // 已编译的程序机器代码  
-----------------------  
|     .rodata         |  // 只读数据  
-----------------------  
|      .data          |  // 已初始化的全局和静态变量  
-----------------------  
|       .bss          |  // 未初始化的全局和静态变量  
-----------------------  
|      .symtab        |  // 程序定义引用的func和global信息  
-----------------------  
|                     |  // .text节中位置的列表?linking时需要修改  
|     .rel.text       |  // 调用外部func或引用global的指令需要修改  
|                     |  // 调用本地func不需要修改  
-----------------------    
|                     |  // 被引用或定义的global的重定位信息  
|     .rel.data       |  // 已初始化的全局变量若初始值是全局变量地址或外部定义函数的地址，则需要被修改  
|                     |  //   
-----------------------  
|                     |  // 调试符号表，条目包括：  
|      .debug         |  // 局部变量和类型定义、定义和引用的全局变量，以及原始的C源文件  
|                     |  // 以 - g 选项调用编译器驱动程序时，才 会得到这张表  
-----------------------  
|      .line          |  // 原始程序的行号与.text节中机器指令的映射  
|                     |  // 以 - g 选项调用编译器驱动程序时，才 会得到这张表  
-----------------------  
|      .strtab        |  // 包括.symtab和.debug节中的符号表，以及节头部中的节名字  
-----------------------  
|      节头部表        |  
-----------------------  

```

##### symtab节

```c
// code/link/elfstructs.c
typedef struct {
    int     name;      /* String table offset */
    char    type:4,    /* Function or data (4 bits) */
            binding:4; /* Local or global (4 bits) */
    char    reserved;  /* Unused */
    short   section;   /* Section header index */
    long    value;     /* Section offset or absolute address */
    long    size;      /* Object size in bytes */
} Elf64_Symbol;
```

## 动态链接



